create view vw_qry_rol_menu as
select r.idrol as idrol, m.idmenu as idmenu, r.nombre as rol_name, m.nombre as menu_name from rol_menu rm, rol r, menu m
where rm.idmenu = m.idmenu
and r.idrol = rm.idrol;

create or replace view vw_qry_user_roles as
 SELECT ru.rol_usu_nomusu AS nomusu,
    ru.rol_usu_idrol AS idrol,
    r.nombre
   FROM rol_usuario ru,
    rol r
  WHERE ru.rol_usu_idrol = r.idrol;


alter table rol_usuario add column reg_status int;
alter table rol_menu add column reg_status int;
alter table usu_aplicacion add column reg_status int;

update rol_usuario set reg_status = 0;
update rol_menu set reg_status = 0;
update usu_aplicacion set reg_status = 0;

create or replace view vw_qry_pending_role_user as
SELECT r.nombre,
    u.nomusu,
    u.primerautorizador,
	r.idrol,
	ru.deleteru
   FROM rol_usuario ru,
    usuario u,
    rol r
  WHERE ru.reg_status = 1 AND ru.rol_usu_nomusu::text = u.nomusu::text AND r.idrol = ru.rol_usu_idrol;
  
  grant select on vw_qry_pending_role_user to standardUser;
  
  
grant select on vw_qry_pending_role_user to jabal;
grant select on vw_qry_pending_role_user to jpizquierdo;
grant select on vw_qry_pending_role_user to emmanuel;


grant update on rol_usuario to standardUser;

grant update on rol_usuario to jabal;
  grant update on rol_usuario to emmanuel;
  grant update on rol_usuario to jpizquierdo;
  
grant update on table usuario to jabal;
  grant select on table usuario to jabal;
  grant delete on table usuario to jabal;
  
  grant update on table usuario to standardUser;
  grant select on table usuario to standardUser;
  grant delete on table usuario to standardUser;
  
  
create or replace view vw_qry_pending_user_app as
SELECT a.nombre,
    u.nomusu,
    u.primerautorizador,
    a.idaplicacion,
	ua.deleteua
   FROM usu_aplicacion ua,
    usuario u,
    aplicacion a
  WHERE ua.reg_status = 1 AND ua.usu_apl_nomusu::text = u.nomusu::text AND a.idaplicacion = ua.idaplicacion;
  
  
  
  grant update on vw_qry_pending_user_app to standardUser;
grant update on  vw_qry_pending_user_app to jabal;
grant update on  vw_qry_pending_user_app to jpizquierdo;
grant update on  vw_qry_pending_user_app to emmanuel;

grant select on  vw_qry_pending_user_app to standardUser;
grant select on  vw_qry_pending_user_app to jabal;
grant select on  vw_qry_pending_user_app to jpizquierdo;
grant select on  vw_qry_pending_user_app to emmanuel;

grant delete on  vw_qry_pending_user_app to standardUser;
grant delete on  vw_qry_pending_user_app to jabal;
grant delete on  vw_qry_pending_user_app to jpizquierdo;
grant delete on  vw_qry_pending_user_app to emmanuel;



grant update on table usu_aplicacion to standardUser;
grant update on table usu_aplicacion to jabal;
grant update on table usu_aplicacion to jpizquierdo;
grant update on table usu_aplicacion to emmanuel;

grant select on table usu_aplicacion to standardUser;
grant select on table usu_aplicacion to jabal;
grant select on table usu_aplicacion to jpizquierdo;
grant select on table usu_aplicacion to emmanuel;

grant delete on table usu_aplicacion to standardUser;
grant delete on table usu_aplicacion to jabal;
grant delete on table usu_aplicacion to jpizquierdo;
grant delete on table usu_aplicacion to emmanuel;


alter table rol_usuario add column deleteru varchar(255);
alter table usu_aplicacion add column deleteua varchar(255);
alter table rol_menu add column deleterm varchar(255);

CREATE SEQUENCE serie_log START 1;


alter table logs alter column log_nom_usu_usuario drop not null;
alter table logs alter column log_idfuncionalidad drop not null;
alter table logs alter column log_idaplicacion drop not null;
alter table logs alter column idrol drop not null;

grant select on table logs to jabal;
grant delete on table logs to jabal;
grant update on table logs to jabal;

grant select on table logs to standardUser;
grant delete on table logs to standardUser;
grant update on table logs to standardUser;

grant select on table logs to emmanuel;
grant delete on table logs to emmanuel;
grant update on table logs to emmanuel;

grant select on table logs to jpizquierdo;
grant delete on table logs to jpizquierdo;
grant update on table logs to jpizquierdo;

grant usage, select on serie_log to jabal;

grant usage, select on serie_log to standardUser;

grant usage, select on serie_log to emmanuel;

grant usage, select on serie_log to jpizquierdo;

alter table usuario add column reg_status int;

update usuario set reg_status = 0;

alter table usuario add column deleteuser varchar(200);


alter table usu_aplicacion drop constraint usu_aplicacion_pkey;

alter table logs add column idmenu int;
alter table logs add constraint fk_idmenu foreign key (idmenu) references menu(idmenu)